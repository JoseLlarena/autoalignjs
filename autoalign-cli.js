#!/usr/bin/env node
"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function text_to(e,t){return(0,_fs.writeFile)(e,t,function(e){e&&(error(e),process.exit(-1))}),e}function pairs_from(e){var t=/^\s*[^\s,]+(\s+[^\s,]+)*?\s*,\s*[^\s,]+(\s+[^\s,]+)*?\s*$/;return(0,_fs.readFileSync)(e,"utf8").split("\n").map(function(e){if(!e)return null;if(!t.test(e))throw{name:"Invalid Row Structure",message:"row has an invalid structure: "+e};return e.split(",").map(function(e){return e.match(/\S+/g)})}).filter(Boolean)}function to_console(e,t){"cost"===e?out("["+(new Date).toLocaleTimeString()+"] avg.unnorm.cost: "+t):"output"!==e&&"input"!==e||out("["+(new Date).toLocaleTimeString()+"] "+t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.pairs_from=pairs_from;var _=require("./"),_fs=require("fs"),_commander=require("commander"),_commander2=_interopRequireDefault(_commander),_console=console,out=_console.log,error=_console.error;_commander2.default.version("1.0.0").name("autoalign").option("-i --input <file>","input file; format: LEFT, RIGHT with white-space separated symbols").option("-m --machine [file]","machine-readable output; format: LEFT, RIGHT, SCORE").option("-u --human [file]","human-readable output, format: SCORE LEFT \\n\\r RIGHT").parse(process.argv),_commander2.default.input||(error("\nNo file input given. Try again."),_commander2.default.help()),!0===_commander2.default.human&&(error("\nhuman output file is empty. Try again."),_commander2.default.help()),!0===_commander2.default.machine&&(error("machine output file is empty. Try again."),_commander2.default.help());var pairs=pairs_from(_commander2.default.input);to_console("input","read "+pairs.length+" pairs from "+_commander2.default.input);var alignments=(0,_.autoalign)(pairs,_.uniform_cost_fn_estimator,_.pmi_cost_fn_from,to_console);_commander2.default.machine&&(text_to(_commander2.default.machine,(0,_.csv_text_from_alignments)(alignments.sort(_.BY_ALPHA))),to_console("output","wrote "+alignments.length+" alignments to "+_commander2.default.machine)),_commander2.default.human&&(text_to(_commander2.default.human,(0,_.pretty_text_from_alignments)(alignments.sort(_.BY_SCORE))),to_console("output","wrote "+alignments.length+" alignments to "+_commander2.default.human)),_commander2.default.machine||_commander2.default.human||(out((0,_.pretty_text_from_alignments)(alignments.sort(_.BY_SCORE))),to_console("output","wrote "+alignments.length+" alignments to console"));